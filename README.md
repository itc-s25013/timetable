# 時間割検索システム (Timetable Search System)

Next.js と microCMS を組み合わせた、学期・学年・学科ごとに時間割を素早く検索・閲覧できるWebアプリケーション。

## 1. 機能の説明

- **条件絞り込み検索**: 学期（前・後）、学年、学科を選択して対象の時間割を表示。
- **学科の動的連動**: 選択した「学年」に応じて、選択可能な「学科」リストを自動切り替え。
- **任意条件フィルタリング**: 曜日や時間帯（午前・午後）を指定したピンポイント検索が可能。
- **レスポンシブな時間割表示**: 授業がない枠は自動的に「休み」と表示するグリッド形式のテーブルを採用。

## 2. ページ構成の説明

- **トップページ (`/`)**: 検索条件を指定するメインフォーム。`<SearchForm />` を配置。
- **検索結果ページ (`/results`)**: 条件に基づきサーバー側でデータを取得し、時間割テーブルを表示。

## 3. ディレクトリ構成の説明

- `app/`: ページのルーティング（App Router）とスタイル（CSS Modules）を管理。
- `components/`: フォームやテーブルなど、再利用可能なUI部品を格納。
- `lib/`: API通信ロジック、定数（学科・学年データ）、型定義を管理。

## 4. microCMS にアクセスする処理の説明

- `lib/microcms.ts` 内で `fetch` API を利用し、microCMS エンドポイントへリクエストを送信。
- `filters` パラメータを用い、`[contains]` や `[and]` による複数条件の同時フィルタリングを実現。
- `cache: "no-store"` を指定し、常に最新のデータを取得するリアルタイム性を確保。

## 5. 工夫した点

- 学年を入力すると、その学年に存在する学科名だけを選択できるようにしたところ
- 検索結果ページからトップページに戻っても、先程検索した際の履歴が残るようにしたところ
- 必須項目の学期、学年、学科以外を自由な検索にして検索の幅を広げたところ

## 6. 苦労した点

- 全学年の全学期の時間割のデータを入力するのが大変だった
- AIに大きく頼って、理解が深まっていない中での作業だったのでバグが起きたときや思い通りの動作をしなかった時の対処が大変だった
- 理解を深めるのがそもそも大変だった

## ファイル構成と役割

### 1. ページ（Pages）

表示の入り口となるファイルです。

- **`app/layout.tsx`**：アプリケーション全体の共通レイアウトを定義します。フォントの設定やグローバルなスタイル（`globals.css`）の読み込みを行っています。
- **`app/page.tsx`**：トップページ（検索画面）の定義です。検索フォームコンポーネント（`SearchForm`）を配置しています。
- **`app/results/page.tsx`**：検索結果ページです。URLの検索パラメータから条件を読み取り、APIを通じてデータを取得・表示する司令塔の役割を果たします。

### 2. コンポーネント（Components）

画面を構成するUI部品です。

- **`components/SearchForm.tsx`**：ユーザーが条件（学期・学年・学科など）を選択するフォーム本体です。学年に応じた学科の動的な切り替えや、入力バリデーションのロジックが含まれています。
- **`components/TimetableTable.tsx`**：取得した時間割データを週間の表形式に整形して表示します。データが存在しない枠を自動的に「休み」として表示するロジックを持っています。
- **`components/BackToSearchButton.tsx`**：検索結果から検索条件を保持したままトップページに戻るためのボタンコンポーネントです。

### 3. ロジック・型定義（Lib）

データの処理や定義をまとめたファイルです。

- **`lib/microcms.ts`**：microCMS APIとの通信を担当します。`fetchTimetableSlots` 関数により、指定された条件で時間割データをフィルタリングして取得します。
- **`lib/constants.ts`**：学期、学年、曜日、時間帯のリストや、学年ごとの学科リストなど、アプリ全体で使用する定数データを管理しています。
- **`lib/types.ts`**：時間割データ（`TimetableSlot`）や各項目の型定義をまとめています。

### 4. スタイル（Styles）

- **`app/globals.css`**：アプリ全体の共通スタイル定義です。
- **`*.module.css`**：CSS Modulesを使用し、各コンポーネントやページに限定したスタイルを定義しています。

---

## システムの仕組み

- **入力**：`SearchForm.tsx` で選択された条件をURLパラメータに変換し、結果ページへ遷移します。
- **通信**：`results/page.tsx` が `lib/microcms.ts` を呼び出し、サーバー側で最新のデータを取得します。
- **表示**：取得したデータを `TimetableTable.tsx` が受け取り、曜日と時間帯（午前・午後）に基づいて表形式に展開します。
